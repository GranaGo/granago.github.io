<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gran√°Go</title>
    <meta name="theme-color" content="#000000" />
    <meta
      name="google-site-verification"
      content="WYhRzsesqTEFSgFBxUaCCt5zwCAkuyjUtUk9-QBTICA"
    />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9486818077772141"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"
    />
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <link rel="stylesheet" href="css/styles.css?v=v4.1" />
    <link rel="preload" as="image" href="imagenes/Fondo.webp" />

    <link rel="icon" type="image/x-icon" href="imagenes/Logo.ico" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="imagenes/Logo192x192.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
  </head>

  <body class="min-h-screen flex flex-col text-gray-800">
    <div class="absolute top-4 left-4 z-50 flex gap-2">
      <button
        onclick="cambiarIdioma('es')"
        class="w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-lg hover:scale-110 transition-transform cursor-pointer focus:outline-none"
        title="Espa√±ol"
      >
        <img
          src="https://flagcdn.com/w80/es.png"
          alt="Espa√±ol"
          class="w-full h-full object-cover"
        />
      </button>
      <button
        onclick="cambiarIdioma('en')"
        class="w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-lg hover:scale-110 transition-transform cursor-pointer focus:outline-none"
        title="English"
      >
        <img
          src="https://flagcdn.com/w80/gb.png"
          alt="English"
          class="w-full h-full object-cover"
        />
      </button>
    </div>

    <div id="google_translate_element" style="display: none"></div>

    <button
      id="theme-toggle"
      aria-label="Cambiar tema"
      class="absolute top-4 right-4 z-50 p-3 rounded-full bg-white text-gray-800 shadow-lg border border-gray-200 hover:scale-110 transition-transform duration-200 dark:bg-gray-800 dark:text-white"
    >
      üåô
    </button>

    <div
      class="fixed inset-0 bg-no-repeat bg-center bg-cover pointer-events-none opacity-15 -z-10"
      style="background-image: url('imagenes/Fondo.webp')"
    ></div>

    <div
      id="app"
      class="w-full p-4 sm:p-6 md:p-8 flex-grow max-w-7xl mx-auto z-10 relative"
    >
      <header class="mb-8 pt-2 text-center border-b border-gray-200 pb-4">
        <a
          href="#"
          onclick="event.preventDefault(); navigateTo('home')"
          class="inline-block transform hover:scale-105 transition duration-200"
        >
          <img
            src="imagenes/Logo.webp"
            onerror="this.src='https://via.placeholder.com/150?text=Gran√°Go'"
            alt="Gran√°Go Logo"
            class="h-16 w-auto object-contain"
          />
        </a>
      </header>

      <div id="home-view" class="view-section active">
        <section>
          <h2 class="text-xl font-semibold mb-6 text-center md:text-left">
            Servicios Principales
          </h2>
          <div
            id="home-grid"
            class="grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6"
          ></div>
        </section>
      </div>

      <div id="info-transporte-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Informaci√≥n de Transporte</h2>
        </div>
        <div id="info-content-container" class="space-y-6"></div>
      </div>

      <div id="transporte-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Transporte P√∫blico</h2>
        </div>

        <div class="mb-4 w-full">
          <div class="relative group">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <svg
                class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <input
              type="text"
              id="map-search-input"
              class="block w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl leading-5 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out shadow-sm text-sm"
              placeholder="Buscar parada por nombre (Ej: Gran V√≠a...)"
            />
            <button
              onclick="filtrarParadasMapa()"
              class="absolute inset-y-1 right-1 px-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm flex items-center justify-center"
              aria-label="Buscar"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </button>
          </div>
        </div>

        <div
          id="map-transporte-container"
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative"
        >
          <div
            id="map-transporte"
            class="w-full h-[400px] rounded-2xl z-0"
          ></div>

          <div
            class="controls-transporte absolute top-4 left-1/2 transform -translate-x-1/2 z-10 p-2 rounded-xl bg-white bg-opacity-90 shadow-xl border border-gray-200 flex space-x-2"
          >
            <button
              id="btnUrbano"
              class="btn btn-urbano px-4 py-2 text-xs font-bold rounded-lg transition-colors duration-200 active-layer flex items-center"
              onclick="toggleLayer('urbano')"
            >
              <svg
                class="h-5 w-5 mr-1 icon-transport"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4S4 2.5 4 6v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-9-11c0-.55.45-1 1-1h8c.55 0 1 .45 1 1v4H6V6z"
                />
              </svg>
              Urbano
            </button>

            <button
              id="btnInter"
              class="btn btn-inter px-4 py-2 text-xs font-bold rounded-lg transition-colors duration-200 inactive-layer flex items-center"
              onclick="toggleLayer('inter')"
            >
              <svg
                class="h-5 w-5 mr-1 icon-transport"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4S4 2.5 4 6v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-9-11c0-.55.45-1 1-1h8c.55 0 1 .45 1 1v4H6V6z"
                />
              </svg>
              Interurbano
            </button>

            <button
              id="btnMetro"
              class="btn btn-metro px-4 py-2 text-xs font-bold rounded-lg transition-colors duration-200 inactive-layer flex items-center"
              onclick="toggleLayer('metro')"
            >
              <svg
                class="h-5 w-5 mr-1 icon-transport"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2c-4 0-8 .5-8 4v9.5C4 17.43 5.57 19 7.5 19L6 20.5v.5h2.23l2-2H14l2 2h2v-.5L16.5 19c1.93 0 3.5-1.57 3.5-3.5V6c0-3.5-3.58-4-8-4zM7.5 17c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm3.5-7H6V6h5v4zm2 0V6h5v4h-5zm3.5 7c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                />
              </svg>
              Metro
            </button>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <section
            class="bg-white p-6 rounded-3xl shadow-lg border-t-4 border-red-600"
          >
            <h2 class="text-xl font-bold mb-4 flex items-center">
              <span class="bg-red-100 p-2 rounded-lg mr-3">
                <svg
                  class="h-6 w-6 text-red-600"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4S4 2.5 4 6v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-9-11c0-.55.45-1 1-1h8c.55 0 1 .45 1 1v4H6V6z"
                  />
                </svg>
              </span>
              Localiza tu Bus
            </h2>
            <div class="space-y-3">
              <input
                type="number"
                id="stop-code"
                placeholder="Ej: 74 (C√≥digo Parada)"
                class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-red-500 focus:outline-none transition"
                pattern="[0-9]*"
              />
              <div
                id="bus-favorites"
                class="flex flex-wrap gap-2 empty:hidden animate-fade-in"
              ></div>
              <button
                onclick="searchStop()"
                class="w-full bg-red-600 hover:bg-red-700 text-white p-3 rounded-xl font-bold transition shadow-md"
              >
                BUSCAR BUSES
              </button>
            </div>
            <div id="bus-results" class="mt-4 space-y-3"></div>
          </section>

          <section
            class="bg-white p-6 rounded-3xl shadow-lg border-t-4 border-green-600"
          >
            <h2 class="text-xl font-bold mb-4 flex items-center">
              <span class="bg-green-100 p-2 rounded-lg mr-3">
                <svg
                  class="h-6 w-6 text-green-600"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 2c-4 0-8 .5-8 4v9.5C4 17.43 5.57 19 7.5 19L6 20.5v.5h2.23l2-2H14l2 2h2v-.5L16.5 19c1.93 0 3.5-1.57 3.5-3.5V6c0-3.5-3.58-4-8-4zM7.5 17c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm3.5-7H6V6h5v4zm2 0V6h5v4h-5zm3.5 7c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
                  />
                </svg>
              </span>
              Localiza tu Metro
            </h2>
            <div class="space-y-3">
              <select
                id="metro-stop-select"
                class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:outline-none bg-white"
              >
                <option value="">Cargando paradas...</option>
              </select>
              <div
                id="metro-favorites"
                class="flex flex-wrap gap-2 empty:hidden animate-fade-in"
              ></div>
              <button
                onclick="searchMetroStop()"
                class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-xl font-bold transition shadow-md"
              >
                BUSCAR METROS
              </button>
            </div>
            <div id="metro-results" class="mt-4 space-y-3"></div>
          </section>
        </div>
      </div>

      <div id="zbe-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Zona de Bajas Emisiones (ZBE)</h2>
        </div>

        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden"
        >
          <div
            id="zbe-map-container"
            onclick="openZbeModal()"
            class="w-full h-[300px] md:h-[500px] bg-gray-50 rounded-2xl relative overflow-hidden cursor-pointer group"
          >
            <img
              id="zbe-map-img"
              src="imagenes/zbeMapa.webp"
              onerror="this.src='https://via.placeholder.com/800x600?text=Mapa+ZBE'"
              alt="Plano ZBE Vista Previa"
              class="w-full h-full object-contain pointer-events-none"
            />
            <div
              class="absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-sm pointer-events-none flex items-center gap-2"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"
                ></path>
              </svg>
              Toca para ampliar
            </div>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div
            class="bg-white rounded-3xl shadow-lg p-6 border-l-4 border-blue-500"
          >
            <h3 class="text-lg font-bold mb-4 text-gray-800 dark:text-white">
              üìç L√≠mites ZBE (23.55 km¬≤)
            </h3>
            <ul
              class="text-sm space-y-3 text-gray-600 max-h-80 overflow-y-auto pr-2 custom-scrollbar"
            >
              <li>
                <span class="normativa-title text-blue-600">ZONA ESTE:</span>
                Camino del Sacromonte (Abad√≠a incluida). Cruce Rte. El Caldero
                (control accesos Ctra. Murcia/Fargue).
              </li>
              <li>
                <span class="normativa-title text-blue-600"
                  >ZONA NORTE / ALFACAR:</span
                >
                Ciudad Deportiva <strong>INCLUIDA</strong>. Calles Pegaso y
                Merced Alta <strong>NO INCLUIDAS</strong>. L√≠mite con Caser√≠a de
                los Cipreses.
              </li>
              <li>
                <span class="normativa-title text-blue-600"
                  >ZONA NOROESTE:</span
                >
                Avd. Blas de Otero, Lepanto, Racimos, El Jau y borde Parque
                Cronista Juan Burgos.
              </li>
              <li>
                <span class="normativa-title text-blue-600">ZONA OESTE:</span>
                Borde Parque Alquer√≠as. Camino de Ca√±averal, Parque F.G. Lorca y
                C/ Eudoxia Pririz <strong>INCLUIDOS</strong>. <br /><em
                  class="text-xs"
                  >Accesos Parking:</em
                >
                Mar√≠a Moliner y Prof. Luis Molina G√≥mez (Abiertos).
              </li>
              <li>
                <span class="normativa-title text-blue-600"
                  >ZONA SUR / SUROESTE:</span
                >
                Avd. Innovaci√≥n <strong>INCLUIDA</strong>. L√≠mite con R√≠o
                Monachil. <br /><em class="text-xs"
                  >No incluidas (Acceso Parking Los C√°rmenes):</em
                >
                Avd. Jes√∫s Candel, Conocimiento, Torre Comares y Sultana.
              </li>
              <li>
                <span class="normativa-title text-blue-600"
                  >ZONA SURESTE / ALHAMBRA:</span
                >
                T√©rmino municipal incluido excepto Paseo de Cameros y Avd. Santa
                Mar√≠a de la Alhambra.
                <br /><strong>NO INCLUIDOS:</strong> Patronato de la Alhambra y
                acceso al Cementerio.
              </li>
              <li>
                <span class="normativa-title text-red-500"
                  >V√çAS EXCLUIDAS (Rondas):</span
                >
                Circunvalaci√≥n (GR-30), Ronda Sur (A-395) y Merced Alta
                (A-4006).
              </li>
            </ul>
          </div>

          <div
            class="bg-white rounded-3xl shadow-lg p-6 border-l-4 border-green-500"
          >
            <h3 class="text-lg font-bold mb-4">üìã Normativa</h3>
            <div class="space-y-4 text-sm">
              <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                <p class="font-bold text-green-800 mb-1">
                  ‚úÖ Veh√≠culos Permitidos
                </p>
                <ul class="text-green-700 list-disc list-inside space-y-1">
                  <li>
                    Cualquier veh√≠culo con etiqueta
                    <strong>B, C, ECO y CERO</strong>.
                  </li>
                  <li>
                    Veh√≠culos con
                    <strong>domicilio fiscal en Granada</strong> (Residentes),
                    tengan o no etiqueta.
                  </li>
                </ul>
              </div>

              <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                <p class="font-bold text-red-800 mb-1">
                  üö´ Veh√≠culos Restringidos
                </p>
                <p class="text-red-700 mb-2">
                  No pueden acceder los veh√≠culos
                  <strong>sin distintivo ambiental</strong> que
                  <strong>NO</strong> tengan domicilio fiscal en Granada.
                </p>
                <p class="text-xs font-bold text-red-600 uppercase mb-1">
                  Se consideran sin etiqueta:
                </p>
                <ul class="text-red-700 text-xs list-disc list-inside ml-1">
                  <li>Gasolina anteriores a <strong>2001</strong>.</li>
                  <li>Di√©sel anteriores a <strong>2006</strong>.</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="ora-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Estacionamiento Regulado (ORA)</h2>
        </div>

        <div class="flex justify-center mb-4">
          <div class="bg-gray-100 p-1 rounded-xl flex space-x-1 shadow-inner">
            <button
              onclick="switchOraMap('vias')"
              id="btn-map-vias"
              class="px-6 py-2 rounded-lg text-sm font-bold transition-all shadow bg-white text-blue-600"
            >
              Mapa de V√≠as
            </button>
            <button
              onclick="switchOraMap('parquimetros')"
              id="btn-map-parq"
              class="px-6 py-2 rounded-lg text-sm font-bold text-gray-500 hover:text-gray-700 transition-all"
            >
              Mapa de Parqu√≠metros
            </button>
          </div>
        </div>

        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative h-[500px]"
        >
          <div id="map-vias" class="w-full h-full block">
            <iframe
              src="https://www.google.com/maps/d/embed?mid=1CqNCPMeQZcKjz3jQmiJreTeBzSNl_EhZ&ehbc=2E312F"
              width="100%"
              height="100%"
              class="border-0 rounded-2xl"
              loading="lazy"
            ></iframe>
          </div>
          <div id="map-parquimetros" class="w-full h-full hidden">
            <iframe
              src="https://www.google.com/maps/d/embed?mid=1t89zrYQ1x-0jAyc98lr1O_EZTs4&ehbc=2E312F"
              width="100%"
              height="100%"
              class="border-0 rounded-2xl"
              loading="lazy"
            ></iframe>
          </div>
        </div>

        <div
          class="bg-white p-6 rounded-3xl shadow-lg border border-gray-100 mb-6"
        >
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <svg
              class="h-6 w-6 mr-2 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            Horarios
          </h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div
              class="bg-blue-50 p-5 rounded-2xl border border-blue-100 text-sm text-blue-800"
            >
              <p class="font-bold text-blue-900 mb-2 text-base">
                ‚ùÑÔ∏è Invierno (15 Sep - 15 Jun)
              </p>
              Lunes a Viernes: 9:00-14:00 y de 16:30-20:30 <br />
              S√°bados: 9:00-14:00
            </div>
            <div
              class="bg-orange-50 p-5 rounded-2xl border border-orange-100 text-sm text-orange-800"
            >
              <p class="font-bold text-orange-900 mb-2 text-base">
                ‚òÄÔ∏è Verano (16 Jun - 14 Sep)
              </p>
              Lunes a Viernes: 9:00-14:00 y de 17:00-21:00 <br />
              S√°bados: 9:00-14:00
            </div>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6 mb-6">
          <div
            class="bg-white p-5 rounded-3xl shadow-lg border-t-8 border-blue-500 text-sm flex flex-col justify-between"
          >
            <div>
              <div
                class="flex justify-between font-bold text-lg text-gray-800 mb-3"
              >
                <h4>Zona Azul</h4>
                <span
                  class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded self-center"
                  >2h M√°x</span
                >
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  No Residentes
                </p>
                <div
                  class="flex justify-between text-gray-600 border-b border-gray-50 py-1"
                >
                  <span>30 min:</span>
                  <span class="font-bold text-gray-900">0,55 ‚Ç¨</span>
                </div>
                <div
                  class="flex justify-between text-gray-600 border-b border-gray-50 py-1"
                >
                  <span>1 hora:</span>
                  <span class="font-bold text-gray-900">0,90 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600 py-1">
                  <span>2 horas:</span>
                  <span class="font-bold text-gray-900">1,80 ‚Ç¨</span>
                </div>
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  Residentes
                </p>
                <div class="flex justify-between text-gray-600">
                  <span>1 d√≠a:</span>
                  <span class="font-bold text-gray-900">1,05 ‚Ç¨</span>
                </div>
              </div>
            </div>
            <div
              class="pt-3 border-t border-gray-100 bg-red-50 -mx-5 -mb-5 p-4 rounded-b-2xl"
            >
              <p class="font-bold text-xs uppercase text-red-500 mb-2">
                Tarifa Post-Pago (Anulaci√≥n)
              </p>
              <div class="flex justify-between text-red-700 text-xs mb-1">
                <span>Exceso < 30min:</span> <b>3,10 ‚Ç¨</b>
              </div>
              <div class="flex justify-between text-red-700 text-xs">
                <span>No ticket / > 30m:</span> <b>6,30 ‚Ç¨</b>
              </div>
            </div>
          </div>

          <div
            class="bg-white p-5 rounded-3xl shadow-lg border-t-8 border-green-500 text-sm flex flex-col justify-between"
          >
            <div>
              <div
                class="flex justify-between font-bold text-lg text-gray-800 mb-3"
              >
                <h4>Zona Verde</h4>
                <span
                  class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded self-center"
                  >5h M√°x</span
                >
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  No Residentes
                </p>
                <div
                  class="flex justify-between text-gray-600 border-b border-gray-50 py-1"
                >
                  <span>1 hora:</span>
                  <span class="font-bold text-gray-900">0,70 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600 py-1">
                  <span>5 horas:</span>
                  <span class="font-bold text-gray-900">1,45 ‚Ç¨</span>
                </div>
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  Residentes
                </p>
                <div class="flex justify-between text-gray-600">
                  <span>1 d√≠a:</span>
                  <span class="font-bold text-gray-900">1,05 ‚Ç¨</span>
                </div>
              </div>
            </div>
            <div
              class="pt-3 border-t border-gray-100 bg-red-50 -mx-5 -mb-5 p-4 rounded-b-2xl"
            >
              <p class="font-bold text-xs uppercase text-red-500 mb-2">
                Tarifa Post-Pago (Anulaci√≥n)
              </p>
              <div class="flex justify-between text-red-700 text-xs mb-1">
                <span>Exceso < 30min:</span> <b>3,15 ‚Ç¨</b>
              </div>
              <div class="flex justify-between text-red-700 text-xs">
                <span>No ticket / > 30m:</span> <b>6,30 ‚Ç¨</b>
              </div>
            </div>
          </div>

          <div
            class="bg-white p-5 rounded-3xl shadow-lg border-t-8 border-red-500 text-sm flex flex-col justify-between"
          >
            <div>
              <div
                class="flex justify-between font-bold text-lg text-gray-800 mb-3"
              >
                <h4>Zona Roja</h4>
                <span
                  class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded self-center"
                  >1h M√°x</span
                >
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  No Residentes
                </p>
                <div
                  class="flex justify-between text-gray-600 border-b border-gray-50 py-1"
                >
                  <span>30 min:</span>
                  <span class="font-bold text-gray-900">0,55 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600 py-1">
                  <span>1 hora:</span>
                  <span class="font-bold text-gray-900">0,90 ‚Ç¨</span>
                </div>
              </div>
              <div class="mb-3">
                <p class="font-bold text-xs uppercase text-gray-400 mb-1">
                  Residentes
                </p>
                <div class="flex justify-between text-gray-600">
                  <span>1 d√≠a:</span>
                  <span class="font-bold text-gray-900">1,05 ‚Ç¨</span>
                </div>
              </div>
            </div>
            <div
              class="pt-3 border-t border-gray-100 bg-red-50 -mx-5 -mb-5 p-4 rounded-b-2xl"
            >
              <p class="font-bold text-xs uppercase text-red-500 mb-2">
                Tarifa Post-Pago (Anulaci√≥n)
              </p>
              <div class="flex justify-between text-red-700 text-xs mb-1">
                <span>Exceso < 30min:</span> <b>3,10 ‚Ç¨</b>
              </div>
              <div class="flex justify-between text-red-700 text-xs">
                <span>No ticket / > 30m:</span> <b>6,15 ‚Ç¨</b>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <svg
              class="h-6 w-6 mr-2 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
              />
            </svg>
            Listado de v√≠as ORA
          </h3>
          <div
            id="ora-streets-container"
            class="max-h-96 overflow-y-auto custom-scrollbar pr-2"
          ></div>
        </div>
      </div>

      <div id="cortes-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Cortes y Eventos</h2>
        </div>

        <div class="mb-4 w-full">
          <div class="relative group">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <svg
                class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <input
              type="text"
              id="cortes-search-input"
              class="block w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl leading-5 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out shadow-sm text-sm"
              placeholder="Buscar evento (Ej: Manifestaci√≥n, Obras...)"
            />
            <button
              onclick="ejecutarFiltroCortes()"
              class="absolute inset-y-1 right-1 px-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm flex items-center justify-center"
              aria-label="Buscar"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </button>
          </div>
        </div>

        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative z-0"
        >
          <div id="map-cortes" class="w-full h-[400px] rounded-2xl z-0"></div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            <svg
              class="h-6 w-6 mr-2 text-blue-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            Agenda (√öltimos avisos)
          </h3>
          <div
            id="cortes-lista-container"
            class="space-y-4 max-h-[500px] overflow-y-auto custom-scrollbar pr-2"
          ></div>
        </div>
      </div>

      <div id="coche-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Mi Coche</h2>
        </div>

        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative h-[500px]"
        >
          <div id="map-coche" class="w-full h-full rounded-2xl z-0"></div>

          <div
            class="absolute bottom-6 left-4 right-4 z-[400] flex flex-col gap-2 pointer-events-none"
          >
            <button
              id="btn-guardar-coche"
              onclick="guardarUbicacionCoche()"
              class="pointer-events-auto w-fit mx-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-2xl transform transition active:scale-95 flex items-center justify-center gap-2 border-2 border-white/20 backdrop-blur-sm"
            >
              <span>üÖøÔ∏è AQU√ç HE APARCADO</span>
            </button>

            <div
              id="panel-acciones-coche"
              class="hidden flex flex-col gap-2 w-full pointer-events-auto items-center"
            >
              <div
                class="bg-white/90 backdrop-blur-md px-4 py-2 rounded-full border border-gray-200 shadow-md text-center w-fit flex items-center gap-2"
              >
                <p class="text-[10px] text-gray-500 uppercase font-bold">
                  Guardado:
                </p>
                <p
                  id="fecha-coche"
                  class="text-xs font-mono font-bold text-gray-800"
                >
                  --/-- --:--
                </p>
              </div>

              <div class="flex gap-2 w-fit">
                <button
                  onclick="calcularRutaCoche()"
                  class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2 text-sm border-2 border-white/20"
                >
                  <span>üö∂ IR AL COCHE</span>
                </button>

                <button
                  onclick="borrarUbicacionCoche()"
                  class="bg-white hover:bg-red-50 text-red-600 font-bold py-2 px-4 rounded-full shadow-md border border-red-100 transform transition active:scale-95 flex items-center justify-center"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="puntos-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Lugares de Inter√©s</h2>
        </div>

        <div class="mb-4 w-full relative">
          <div class="relative group z-20">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <svg
                class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <input
              type="text"
              id="puntos-search-input"
              class="block w-full pl-10 pr-24 py-3 border border-gray-200 rounded-xl leading-5 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out shadow-sm text-sm"
              placeholder="Buscar por nombre..."
            />
            <button
              onclick="togglePuntosFilterMenu()"
              class="absolute inset-y-1 right-12 px-3 text-gray-500 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors flex items-center justify-center border border-gray-200"
              title="Filtrar categor√≠as"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                ></path>
              </svg>
            </button>
            <button
              onclick="filtrarPuntosMapa(event)"
              class="absolute inset-y-1 right-1 px-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm flex items-center justify-center"
              aria-label="Buscar"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </button>
          </div>

          <div
            id="puntos-filter-panel"
            class="hidden absolute top-full left-0 right-0 mt-2 bg-white p-4 rounded-xl shadow-xl border border-gray-200 z-30 animate-fade-in-down"
          >
            <div class="flex justify-between items-center mb-3">
              <h3 class="text-sm font-bold text-gray-700">
                Filtrar por categor√≠a:
              </h3>
              <button
                onclick="resetPuntosFilters()"
                class="text-xs text-blue-500 hover:text-blue-700 font-semibold"
              >
                Ver todo
              </button>
            </div>
            <div id="puntos-filter-grid" class="flex flex-wrap gap-2"></div>
          </div>
        </div>

        <div
          id="map-puntos-container"
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative"
        >
          <div id="map-puntos" class="w-full h-[600px] rounded-2xl z-0"></div>

          <button
            id="btn-cancel-navigation"
            onclick="detenerNavegacion()"
            class="hidden absolute bottom-8 left-1/2 transform -translate-x-1/2 z-[400] bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all active:scale-95"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
            Cancelar Ruta
          </button>
        </div>
      </div>

      <div id="gasolineras-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Precios de Gasolineras</h2>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-lg mb-4 flex flex-col gap-3">
          <div class="flex flex-col md:flex-row gap-3">
            <select
              id="gas-fuel-select"
              class="p-3 border border-gray-200 rounded-xl flex-1 bg-gray-50 focus:bg-white transition"
              onchange="resetSpecialFilters(); filterGasStations()"
            >
              <option value="NINGUNO">Seleccione tipo de combustible</option>
              <option value="G95">Gasolina sin plomo 95</option>
              <option value="G97">Gasolina sin plomo 97</option>
              <option value="G98">Gasolina sin plomo 98</option>
              <option value="A_HABITUAL">Gas√≥leo A habitual</option>
              <option value="A_MEJORADO">Gas√≥leo A mejorado</option>
              <option value="B">Gas√≥leo B</option>
              <option value="C">Gas√≥leo C</option>
              <option value="BIODIESEL">Biodi√©sel</option>
              <option value="GLP">Autogas GLP</option>
              <option value="GNC">Gas N. Compr</option>
              <option value="GNL">Gas N. Licuado</option>
              <option value="ADBLUE">Adblue</option>
              <option value="DIESEL_REN">Diesel Renovable</option>
              <option value="GASOLINA_REN">Gasolina Renovable</option>
            </select>

            <select
              id="gas-brand-select"
              class="p-3 border border-gray-200 rounded-xl flex-1 bg-gray-50 focus:bg-white transition notranslate"
              onchange="filterGasStations()"
            >
              <option value="ALL">Todas las Marcas</option>
            </select>

            <button
              onclick="fetchGasolineras()"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-bold transition shadow-sm flex items-center justify-center gap-2"
              title="Actualizar datos"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
            </button>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <button
              id="btn-gas-cheap"
              onclick="activarFiltroEspecial('cheap')"
              class="p-2 border border-green-200 bg-green-50 text-green-700 hover:bg-green-100 rounded-lg text-xs font-bold transition flex flex-col items-center justify-center gap-1"
            >
              <span class="text-lg">üí∂</span>
              TOP 3 BARATAS
            </button>

            <button
              id="btn-gas-near"
              onclick="activarFiltroEspecial('near')"
              class="p-2 border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 rounded-lg text-xs font-bold transition flex flex-col items-center justify-center gap-1"
            >
              <span class="text-lg">üìç</span>
              TOP 5 CERCANAS <span class="text-[9px] opacity-70">(< 5km)</span>
            </button>
          </div>
        </div>
        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative h-[500px]"
        >
          <div id="map-gasolineras" class="w-full h-full rounded-2xl z-0"></div>

          <button
            id="btn-cancel-gas-route"
            onclick="detenerRutaGasolinera()"
            class="hidden absolute bottom-8 left-1/2 transform -translate-x-1/2 z-[400] bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all active:scale-95"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
            Cancelar Ruta
          </button>
        </div>
      </div>
      <div id="parkings-view" class="view-section">
        <div class="flex items-center mb-6">
          <button
            onclick="navigateTo('home')"
            class="mr-4 p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h2 class="text-2xl font-bold">Estado Parkings</h2>
        </div>

        <div class="flex justify-end mb-4">
          <button
            onclick="fetchParkingData()"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-bold transition shadow-sm flex items-center gap-2 text-sm"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            Actualizar Datos
          </button>
        </div>

        <div
          class="bg-white p-2 rounded-3xl shadow-lg mb-6 border border-gray-100 overflow-hidden relative h-[400px]"
        >
          <div id="map-parkings" class="w-full h-full rounded-2xl z-0"></div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
          <h3 class="text-xl font-bold mb-4 flex items-center">
            üÖøÔ∏è Disponibilidad en Tiempo Real
          </h3>
          <div class="overflow-x-auto custom-scrollbar">
            <table class="w-full text-sm text-left text-gray-500">
              <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                <tr>
                  <th scope="col" class="px-4 py-3 rounded-l-lg">Parking</th>
                  <th scope="col" class="px-4 py-3 text-center">Estado</th>
                  <th scope="col" class="px-4 py-3 rounded-r-lg text-right">
                    Plazas
                  </th>
                </tr>
              </thead>
              <tbody id="parking-table-body"></tbody>
            </table>
            <p class="text-[10px] text-gray-400 mt-4 text-center">
              Fuente: Movilidad Granada. Datos actualizados en tiempo real.
            </p>
          </div>
        </div>
      </div>
    </div>
    <div
      id="zbe-modal"
      class="fixed inset-0 z-[100] bg-black/90 hidden flex items-center justify-center overflow-hidden touch-none transition-opacity duration-300 opacity-0"
    >
      <button
        onclick="closeZbeModal()"
        class="absolute top-4 right-4 z-[101] text-white bg-gray-800/50 p-3 rounded-full hover:bg-gray-700 transition"
      >
        <svg
          class="w-8 h-8"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>

      <div
        class="w-full h-full flex items-center justify-center overflow-hidden"
      >
        <img
          id="zbe-modal-img"
          src="imagenes/zbeMapa.webp"
          class="max-w-none origin-center cursor-grab transition-transform duration-75 ease-linear will-change-transform"
          draggable="false"
          alt="Mapa ZBE Full"
        />
      </div>

      <div
        id="modal-instructions"
        class="absolute bottom-10 left-1/2 transform -translate-x-1/2 text-white/70 text-sm bg-black/40 px-4 py-2 rounded-full pointer-events-none"
      >
        Usa dos dedos para zoom / Arrastra para mover
      </div>
    </div>

    <div
      id="custom-confirm-modal"
      class="fixed inset-0 z-[500] bg-black/50 hidden items-center justify-center transition-opacity duration-300 opacity-0"
    >
      <div
        class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4"
      >
        <p
          id="modal-message-text"
          class="text-lg font-semibold mb-6 text-gray-800 dark:text-gray-100"
        >
          ¬øSeguro que quieres borrar la ubicaci√≥n del coche?
        </p>
        <div class="flex justify-end gap-3">
          <button
            id="modal-cancel-btn"
            class="px-4 py-2 text-sm font-medium rounded-lg text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition"
          >
            Cancelar
          </button>
          <button
            id="modal-confirm-btn"
            class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 transition"
          >
            Borrar
          </button>
        </div>
      </div>
    </div>

    <div
      id="arrival-notification"
      class="fixed inset-0 z-[1000] hidden flex items-center justify-center pointer-events-none"
    >
      <div
        class="bg-green-600 text-white font-black text-2xl px-8 py-6 rounded-2xl shadow-2xl transform scale-0 transition-transform duration-300 flex flex-col items-center gap-2 animate-bounce-in"
      >
        <svg
          class="w-12 h-12"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
          ></path>
        </svg>
        <span>¬°HAS LLEGADO!</span>
      </div>
    </div>

    <div
      id="readme-modal"
      class="fixed inset-0 z-[2000] bg-black/80 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 opacity-0"
    >
      <div
        class="bg-white w-full max-w-4xl max-h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 transform scale-95 transition-transform duration-300"
      >
        <div
          class="p-4 border-b border-gray-100 flex items-center gap-3 bg-gray-50"
        >
          <button
            onclick="closeReadmeModal()"
            class="p-2 bg-white text-blue-600 rounded-full hover:bg-blue-50 transition shadow-sm border border-gray-200"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
          </button>
          <h3 class="font-bold text-lg text-gray-800 flex-grow">
            Sobre el Proyecto
          </h3>
          <button
            onclick="closeReadmeModal()"
            class="p-2 hover:bg-gray-200 rounded-full transition text-gray-500"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div
          id="readme-content"
          class="p-6 overflow-y-auto custom-scrollbar prose prose-sm md:prose-base max-w-none"
        >
          <div class="flex justify-center py-10">
            <div
              class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="cookie-banner"
      class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-4 z-[3000] hidden flex-col md:flex-row gap-4 items-center justify-between transition-transform duration-300 transform translate-y-full"
    >
      <div class="text-sm text-gray-600 flex-1">
        <p>
          üç™ <strong>Usamos cookies</strong> para recordar d√≥nde aparcas y
          permitir la traducci√≥n con Google. No guardamos datos personales.
          Consulta nuestra
          <a
            href="#"
            onclick="event.preventDefault(); openReadmeModal(); setTimeout(() => { document.getElementById('legal').scrollIntoView({behavior: 'smooth', block: 'start'}); }, 500);"
            class="text-blue-600 underline font-bold"
            >Pol√≠tica de Privacidad</a
          >.
        </p>
      </div>
      <div class="flex gap-3 shrink-0">
        <button
          onclick="rechazarCookies()"
          class="px-4 py-2 text-sm font-bold text-gray-500 bg-gray-100 hover:bg-gray-200 rounded-lg transition"
        >
          Rechazar
        </button>
        <button
          onclick="aceptarCookies()"
          class="px-4 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-md transition"
        >
          Aceptar y Continuar
        </button>
      </div>
    </div>

    <footer
      class="w-full text-xs text-gray-400 border-t border-gray-200 bg-white mt-8 z-10 relative"
    >
      <div
        class="max-w-7xl mx-auto py-6 px-4 sm:px-6 grid grid-cols-3 items-center"
      >
        <div class="col-span-1 flex justify-start">
          <button
            onclick="openReadmeModal()"
            class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold text-xs py-2 px-4 rounded-full transition shadow-md border border-gray-200 flex items-center gap-1 cursor-pointer focus:outline-none btn-info-style"
            title="Ver informaci√≥n del proyecto"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            + Info
          </button>
        </div>

        <span class="col-span-1 text-center flex flex-col">
          <span>¬© 2025 Gran√°Go. Todos los derechos reservados.</span>
          <a
            href="#"
            onclick="event.preventDefault(); openReadmeModal(); setTimeout(() => { document.getElementById('legal').scrollIntoView({behavior: 'smooth', block: 'start'}); }, 500);"
            class="text-[10px] text-gray-500 hover:text-blue-500 hover:underline mt-1"
          >
            Aviso Legal y Privacidad
          </a>
        </span>

        <div class="col-span-1 flex justify-end">
          <a
            href="https://www.paypal.com/donate/?hosted_button_id=ELYXMJVZP5B8W"
            target="_blank"
            rel="noopener noreferrer"
            class="boton-donacion-paypal"
            title="Apoyar a Gran√°Go a trav√©s de PayPal"
          >
            <button
              class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold text-xs py-2 px-4 rounded-full transition shadow-md border border-gray-200 flex items-center gap-1"
            >
              <img
                src="imagenes/paypal.svg"
                alt="PayPal Icono"
                class="w-4 h-4"
              />
              ¬°D√≥name!
            </button>
          </a>
        </div>
      </div>
    </footer>

    <script src="js/main.js?v=v4.1" type="module"></script>

    <script>
      const toggleButton = document.getElementById("theme-toggle");
      const body = document.body;

      // Funci√≥n unificada para aplicar el tema
      function setTheme(isDark) {
        if (isDark) {
          body.classList.add("dark-mode");
          toggleButton.innerHTML = "‚òÄÔ∏è"; // Icono Sol
          toggleButton.style.backgroundColor = "#333";
          toggleButton.style.color = "#fff";
          localStorage.setItem("theme", "dark");
        } else {
          body.classList.remove("dark-mode");
          toggleButton.innerHTML = "üåô"; // Icono Luna
          toggleButton.style.backgroundColor = "#fff";
          toggleButton.style.color = "#333";
          localStorage.setItem("theme", "light");
        }
      }

      // 1. Cargar preferencia al iniciar
      // Comprueba localStorage o preferencia del sistema si es la primera vez
      const savedTheme = localStorage.getItem("theme");
      const systemPrefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;

      if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
        setTheme(true);
      } else {
        setTheme(false);
      }

      // 2. Evento Click
      toggleButton.addEventListener("click", () => {
        const isCurrentlyDark = body.classList.contains("dark-mode");
        setTheme(!isCurrentlyDark); // Invertir estado
      });
    </script>

    <script>
      let newWorker;
      let refreshing = false;

      // Evento para recargar la p√°gina cuando el nuevo SW tome el control
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          if (!refreshing) {
            refreshing = true;
            window.location.reload();
          }
        });

        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./sw.js", { scope: "/" })
            .then((reg) => {
              console.log("SW registrado:", reg.scope);

              // 1. COMPROBACI√ìN INICIAL: ¬øHay una actualizaci√≥n esperando?
              // Si el usuario acaba de abrir la app y ya hab√≠a una versi√≥n nueva descargada de antes,
              // la aplicamos directamente sin preguntarle.
              if (reg.waiting) {
                console.log(
                  "Actualizaci√≥n pendiente encontrada al inicio. Aplicando..."
                );
                reg.waiting.postMessage({ action: "skipWaiting" });
                return;
              }

              // 2. DETECCI√ìN DE NUEVAS VERSIONES (Mientras se usa la app)
              reg.addEventListener("updatefound", () => {
                newWorker = reg.installing;

                newWorker.addEventListener("statechange", () => {
                  // Si el nuevo worker se ha instalado correctamente
                  if (
                    newWorker.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    // Aqu√≠ lanzamos el aviso visual porque el usuario ya est√° usando la app
                    showUpdateNotification(newWorker);
                  }
                });
              });

              // Opcional: Forzar chequeo de actualizaci√≥n al cargar
              reg.update();
            })
            .catch((err) => console.error("Error SW:", err));
        });
      }

      /* Funci√≥n que muestra el banner (Llama a tu funci√≥n de main.js) */
      function showUpdateNotification(worker) {
        if (typeof window.lanzarAvisoActualizacion === "function") {
          window.lanzarAvisoActualizacion(worker);
        } else {
          // Fallback por seguridad
          let confirmar = confirm(
            "Nueva versi√≥n disponible. ¬øActualizar ahora?"
          );
          if (confirmar && worker) {
            worker.postMessage({ action: "skipWaiting" });
          }
        }
      }
    </script>

    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "es",
          },
          "google_translate_element"
        );
      }
    </script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  </body>
</html>
